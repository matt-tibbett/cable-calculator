<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cable Calculator</title>
  <style>
:root {
  --bg: #121212;
  --text: #e0e0e0;
  --accent: #00bcd4;
  --card: #1e1e1e;
  --ok: #00c853;
  --bad: #ff5252;
}

body {
  background-color: var(--bg);
  color: var(--text);
  font-family: "Segoe UI", sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 0;
  padding: 2rem 0;
}

.page-title {
  text-align: center;
  color: var(--accent);
  margin: 0.3rem 0 0;
}

.subtitle {
  text-align: center;
  font-size: 0.9rem;
  color: #aaa;
  margin-bottom: 1.5rem;
}

.mode-select {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 1.5rem;
  font-size: 1rem;
  color: var(--accent);
}

.wrapper {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  gap: 2rem;
  flex-wrap: wrap;
}

.container {
  background: var(--card);
  padding: 1.6rem 2rem 2rem;
  border-radius: 1rem;
  width: 380px;
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.6);
}

h2 {
  text-align: center;
  color: var(--accent);
  font-size: 1.1rem;
  margin-top: 0.3rem;
  margin-bottom: 0.8rem;
}

.input-group {
  margin-bottom: 1rem;
}

.inline2 {
  display: flex;
  justify-content: space-between;
  gap: 0.5rem;
}

.inline2 .col {
  width: 48%;
}

label {
  display: block;
  margin-bottom: 0.3rem;
}

select,
input[type="number"],
input[type="text"],
input[type="range"] {
  width: 100%;
  padding: 0.4rem;
  border-radius: 0.5rem;
  border: none;
  background: #2a2a2a;
  color: var(--text);
  font-size: 1rem;
}

input[type="text"]:disabled,
input[type="number"]:disabled {
  background: #3a3a3a;
  color: #bbb;
}

input[type="range"] {
  cursor: pointer;
}

.checkbox {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  margin-top: 0.3rem;
}

.checkbox.small label {
  font-size: 0.8rem;
}

/* Top Info Section */
.top-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.circuit-type {
  width: 50%;
  border: 1px solid #333;
  border-radius: 0.5rem;
  padding: 0.5rem 0.5rem;
}

.circuit-type legend {
  font-size: 0.9rem;
  color: var(--accent);
}

.circuit-type label {
  display: block;
  font-size: 0.85rem;
  margin-bottom: 0.2rem;
}

.limits {
  width: 50%;
  font-size: 0.9rem;
}

.limits .row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.2rem;
}

/* Output box */
.output {
  background: #2a2a2a;
  padding: 1rem;
  border-radius: 0.5rem;
  font-family: monospace;
}

.output .header-row,
.output .value-row {
  display: flex;
  justify-content: space-between;
  text-align: center;
}

.output .header-row span,
.output .value-row span {
  width: 33%;
}

.output .vd-row {
  text-align: center;
  margin-top: 0.5rem;
}

.ok {
  color: var(--ok);
  font-weight: bold;
}

.bad {
  color: var(--bad);
  font-weight: bold;
}

/* Disabled state for greyed-out inputs and labels */
.disabled {
  opacity: 0.5;
  pointer-events: none;
}

/* Overall results */
.overall-results {
  margin-top: 2rem;
  background: var(--card);
  padding: 1.5rem 2rem;
  border-radius: 1rem;
  width: 800px;
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.6);
  display: none; /* hidden by default (single-circuit mode) */
}

.overall-results h2 {
  text-align: center;
  color: var(--accent);
  margin-bottom: 1rem;
}

.overall-results .header-row,
.overall-results .value-row {
  display: flex;
  justify-content: space-between;
  text-align: center;
}

.overall-results .header-row span,
.overall-results .value-row span {
  width: 33%;
}

</style>
</head>
<body>
  <h1 class="page-title">Cable Calculator</h1>
  <p class="subtitle">(230V Single Phase)</p>

  <!-- Mode toggle -->
  <div class="mode-select">
    <input type="checkbox" id="dual-mode" />
    <label for="dual-mode">Enable Submain</label>
  </div>

  <div class="wrapper">
    <!-- Submain -->
    <div class="container" id="submain">
      <h2>Submain</h2>
      <div class="calc-body"></div>
    </div>

    <!-- Final Circuit -->
    <div class="container" id="circuit">
      <h2>Final Circuit</h2>
      <div class="calc-body"></div>
    </div>
  </div>

  <div class="overall-results">
    <h2>Overall Results</h2>
    <div class="output">
      <div class="header-row">
        <span>Total Zs (Ω)</span>
        <span>Total Volt Drop (V)</span>
        <span>Volt Drop (%)</span>
      </div>
      <div class="value-row">
        <span id="overall-zs">0.00</span>
        <span id="overall-vd">0.00</span>
        <span id="overall-vd-percent">0.00</span>
      </div>
    </div>
  </div>

  <script>
const resistivity = {
  1: 0.0181,
  1.5: 0.0121,
  2.5: 0.00741,
  4: 0.00461,
  6: 0.00308,
  10: 0.00183,
  16: 0.00115,
  25: 0.000727,
  35: 0.000524,
  50: 0.000387,
};

const maxZsTable = {
  B: { 6: 7.67, 15: 3.08, 20: 2.30, 25: 1.84, 32: 1.44, 40: 1.15, 45: 1.02, 50: 0.92, 63: 0.72 },
  C: { 6: 3.83, 15: 1.54, 20: 1.15, 25: 0.92, 32: 0.72, 40: 0.58, 45: 0.51, 50: 0.46, 63: 0.36 },
  D: { 6: 1.92, 15: 0.77, 20: 0.57, 25: 0.46, 32: 0.36, 40: 0.29, 45: 0.26, 50: 0.23, 63: 0.18 },
};

class CableCalculator {
  constructor(root, name, onChange) {
    this.root = root;
    this.name = name;
    this.onChange = onChange;
    this.root.querySelector(".calc-body").innerHTML = this.getTemplate(name);
    this.bindElements();
    this.addListeners();
    this.calculate();
  }

  getTemplate(name) {
    const radioName = `circuit-${name}`;
    return `
      <div class="input-group">
        <label>Ze / Zdb (Ω):</label>
        <input type="number" class="ze" min="0" step="0.01" value="0.35" />
      </div>

      <div class="input-group inline2">
        <div class="col">
          <label>OCPD (A)</label>
          <select class="ocpd">
            ${[6,15,20,25,32,40,45,50,63].map(a => `<option>${a}</option>`).join("")}
          </select>
        </div>
        <div class="col">
          <label>Type</label>
          <select class="type">
            <option>B</option><option>C</option><option>D</option>
          </select>
        </div>
      </div>

      <div class="input-group">
        <label>Design Current (A):</label>
        <input type="text" class="ib" value="32" />
        <div class="checkbox small">
          <input type="checkbox" class="use-ocpd" checked />
          <label>Use OCPD</label>
        </div>
      </div>

      <div class="input-group">
        <label>Conductor CSA (mm²):</label>
        <select class="csa">
         ${Object.keys(resistivity)
         .map(parseFloat)
         .sort((a, b) => a - b)
         .map(s => `<option>${s}</option>`)
         .join("")}
        </select>
      </div>

      <div class="input-group">
        <label>CPC CSA (mm²):</label>
        <select class="cpc">
         ${Object.keys(resistivity)
         .map(parseFloat)
         .sort((a, b) => a - b)
         .map(s => `<option>${s}</option>`)
         .join("")}
        </select>
      </div>

      <div class="input-group">
        <label>Cable Length (m): <span class="length-value">50</span>m</label>
        <input type="range" class="length" min="1" max="100" value="50" />
      </div>

      <div class="top-info">
        <fieldset class="circuit-type">
          <legend>Circuit Type</legend>
          <label><input type="radio" name="${radioName}" value="lighting" checked /> Lighting</label>
          <label><input type="radio" name="${radioName}" value="other" /> Other</label>
        </fieldset>

        <div class="limits">
          <div class="row"><span>Max Zs:</span><span class="max-zs">0.00</span> Ω</div>
          <div class="row"><span>Max Vd:</span><span class="max-vd">0.00</span> V</div>
        </div>
      </div>

      <div class="output">
        <div class="header-row">
          <span>Ze</span><span>R1 + R2</span><span>Zs</span>
        </div>
        <div class="value-row">
          <span class="ze-val">0.35</span><span class="r1r2">0.000</span><span class="zs">0.00</span>
        </div>
        <div class="vd-row">
          <span class="label">Volt Drop:</span>
          <span class="vdrop">0.00</span> V (<span class="vdrop-percent">0.00</span>%)
        </div>
      </div>
    `;
  }

  bindElements() {
    const q = s => this.root.querySelector(s);
    this.inputs = {
      ze: q(".ze"),
      ocpd: q(".ocpd"),
      type: q(".type"),
      csa: q(".csa"),
      cpc: q(".cpc"),
      length: q(".length"),
      ib: q(".ib"),
      useOcpd: q(".use-ocpd"),
      lengthValue: q(".length-value"),
      circuitRadios: this.root.querySelectorAll('fieldset input[type="radio"]'),
    };
    this.outputs = {
      zeVal: q(".ze-val"),
      r1r2: q(".r1r2"),
      zs: q(".zs"),
      vdrop: q(".vdrop"),
      vdropPercent: q(".vdrop-percent"),
      maxZs: q(".max-zs"),
      maxVd: q(".max-vd"),
    };
  }

  addListeners() {
    const i = this.inputs;
    const trigger = () => {
      this.calculate();
      if (this.onChange) this.onChange();
    };

    i.useOcpd.addEventListener("change", () => {
      i.ib.disabled = i.useOcpd.checked;
      if (i.useOcpd.checked) i.ib.value = i.ocpd.value;
      trigger();
    });

    [i.ocpd, i.type, i.csa, i.cpc, i.length, i.ib, i.ze].forEach(el =>
      el.addEventListener("input", trigger)
    );

    i.circuitRadios.forEach(r => r.addEventListener("change", trigger));
  }

  calculate() {
    const i = this.inputs;
    const L = parseFloat(i.length.value);
    const ocpdVal = parseFloat(i.ocpd.value);
    const I = i.useOcpd.checked ? ocpdVal : parseFloat(i.ib.value);
    const r1 = resistivity[parseFloat(i.csa.value)];
    const r2 = resistivity[parseFloat(i.cpc.value)];
    const ze = parseFloat(i.ze.value);
    const breakerType = i.type.value;

    const r1r2 = (r1 + r2) * L;
    const vdrop = I * r1r2;
    const vdropPercent = (vdrop / 230) * 100;
    const zs = ze + r1r2;
    const maxZs = maxZsTable[breakerType][ocpdVal] || 0;
    const circuitType = [...i.circuitRadios].find(r => r.checked).value;
    const maxVd = circuitType === "lighting" ? 230 * 0.03 : 230 * 0.05;

    const o = this.outputs;
    o.zeVal.textContent = ze.toFixed(2);
    o.r1r2.textContent = r1r2.toFixed(4);
    o.zs.textContent = zs.toFixed(2);
    o.vdrop.textContent = vdrop.toFixed(2);
    o.vdropPercent.textContent = vdropPercent.toFixed(2);
    o.maxZs.textContent = maxZs.toFixed(2);
    o.maxVd.textContent = maxVd.toFixed(1);
    i.lengthValue.textContent = L;

    o.vdrop.className = o.vdropPercent.className = vdrop <= maxVd ? "ok" : "bad";
    o.zs.className = zs <= maxZs ? "ok" : "bad";

    return { zs, vdrop, vdropPercent, r1r2 };
  }
}

// --- Initialize calculators ---
const submain = new CableCalculator(document.getElementById("submain"), "sub", updateOverall);
const circuit = new CableCalculator(document.getElementById("circuit"), "circ", updateOverall);
const modeToggle = document.getElementById("dual-mode");

// Mode management
modeToggle.addEventListener("change", () => setMode(modeToggle.checked));

function setMode(dual) {
  const submainDiv = document.getElementById("submain");
  const overallDiv = document.querySelector(".overall-results");

  submainDiv.style.display = dual ? "block" : "none";
  overallDiv.style.display = dual ? "block" : "none";

  // Circuit Ze field
  circuit.inputs.ze.disabled = dual;
  circuit.inputs.ze.classList.toggle("disabled", dual);

  // Submain circuit type always "Other" and disabled
  submain.inputs.circuitRadios.forEach(r => {
    r.checked = r.value === "other";
    r.disabled = dual;
    r.closest("label").classList.toggle("disabled", dual);
  });

  updateOverall();
}

function updateOverall() {
  const dual = modeToggle.checked;
  const overallBox = document.querySelector(".overall-results");

  if (dual) {
    const sub = submain.calculate();
    circuit.inputs.ze.value = sub.zs.toFixed(2);
    circuit.inputs.ze.disabled = true;
    const circ = circuit.calculate();

    const overallZs = sub.zs + circ.r1r2;
    const overallVd = sub.vdrop + circ.vdrop;
    const overallVdPercent = (overallVd / 230) * 100;

    const finalType = [...circuit.inputs.circuitRadios].find(r => r.checked).value;
    const maxOverallPercent = finalType === "lighting" ? 3 : 5;
    const vdOK = overallVdPercent <= maxOverallPercent;

    // Update output
    document.getElementById("overall-zs").textContent = overallZs.toFixed(2);
    document.getElementById("overall-vd").textContent = overallVd.toFixed(2);
    const vdEl = document.getElementById("overall-vd-percent");
    vdEl.textContent = overallVdPercent.toFixed(2);
    vdEl.className = vdOK ? "ok" : "bad";

    // Overall box colour
    overallBox.classList.toggle("ok", vdOK);
    overallBox.classList.toggle("bad", !vdOK);
  } else {
    const circ = circuit.calculate();
    document.getElementById("overall-zs").textContent = circ.zs.toFixed(2);
    document.getElementById("overall-vd").textContent = circ.vdrop.toFixed(2);
    const vdEl = document.getElementById("overall-vd-percent");
    vdEl.textContent = circ.vdropPercent.toFixed(2);
    vdEl.className = "";
    overallBox.classList.remove("ok", "bad");
  }
}

// Initialise default (single-circuit mode)
setMode(false);

</script>
</body>
</html>
